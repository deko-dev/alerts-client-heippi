"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[214],{7214:(T,g,s)=>{s.r(g),s.d(g,{RegisterCodeModule:()=>k});var l=s(8583),t=s(7716),h=s(1102),m=s(8239),b=s(5985),v=s(2340),C=s(1584),f=s(1841),p=s(8263);let S=(()=>{class o extends b.sk{constructor(e,i,r){super({url:v.N.serverSocket}),this.cookieService=e,this.http=i,this.swPush=r,this.alertOut=new t.vpe,this.PUBLIC_VAPID_KEY="BGi3yISPyUrS-F7r8k3umdtVZBJ5Ega3hV-APpz2A6muxS0z51wIo1t3r9dh2ZYgw8LDRI-E9yU4v11_Mxkmr-Y",this.pushSubscription={},this.ioSocket.on("alert",c=>{this.alertOut.emit(c)})}registerCode(e){console.log("Registrando Codigo"),this.ioSocket.emit("default",{cookiePayload:localStorage.getItem("device"),event:"register-code",payload:e})}subscribedSW(){var e=this;return(0,m.Z)(function*(){console.log("SubscribedSW");const i=yield e.swPush.requestSubscription({serverPublicKey:e.PUBLIC_VAPID_KEY});console.log(i)})()}addPushSubscriber(e){return this.http.post("/api/notifications",e)}urlBase64ToUint8Array(e){const r=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),c=window.atob(r),a=new Uint8Array(c.length);for(let u=0;u<c.length;++u)a[u]=c.charCodeAt(u);return a}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(C.N),t.LFG(f.eN),t.LFG(p.Mk))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var d=s(665);function x(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",4),t.TgZ(1,"span",5),t._uU(2,"@"),t.qZA(),t.TgZ(3,"input",6),t.NdJ("ngModelChange",function(r){return t.CHM(e),t.oxw().name=r}),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("ngModel",e.name)}}function I(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){return t.CHM(e),t.oxw().register()}),t._uU(1,"Send"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("disabled",!e.isPermission)}}function A(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().subscribePushNotification()}),t._uU(1," Activar Notificaciones\n"),t.qZA()}}function y(o,n){if(1&o&&(t.TgZ(0,"div",9),t.TgZ(1,"strong"),t._uU(2),t.qZA(),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.hij("Codigo Registrado ",e.code,"")}}function R(o,n){if(1&o&&(t.TgZ(0,"div",9),t.TgZ(1,"strong"),t._uU(2),t.qZA(),t.qZA()),2&o){const e=t.oxw();t.xp6(2),t.Oqu(e.textAlert)}}const P=[{path:":code",component:(()=>{class o{constructor(e,i,r,c){this.activatedRoute=e,this.registerCodeService=i,this.cookieService=r,this.swPush=c,this.name="",this.code="",this.isAlert=!1,this.textAlert="",this.pushSubscription={},this.isPermission=!1,this.isLoading=!1,this.VAPID_PUBLIC_KEY="BLpWrYjfdkphUVTEOlTjKg3InCo99o2-5cvLqiPZ83I6H0Djac-gvXW6AkKrQzXTxp0MEnZUa4GijosGoiKQYJc",this.dataInCookie=!1,"default"===Notification.permission?this.subscribePushNotification():(console.log("Status REGISTER-CODE LINE40",Notification.permission),this.swPush.subscription.subscribe(a=>{console.log(a),this.pushSubscription=a})),this.code=this.activatedRoute.snapshot.params.code,this.registerCodeService.alertOut.subscribe(a=>{console.log(a),a.id_client||(window.navigator.vibrate(3e3),this.isAlert=!0,this.textAlert="Notificado!!!")})}ngOnInit(){if(this.cookieService.get("device")){const e=JSON.parse(this.cookieService.get("device"));this.code!==e.code&&(e.code=this.code),Object.assign(Object.assign({},e),{pushSubscription:this.pushSubscription}),this.registerCodeService.registerCode(e),this.dataInCookie=!0}}register(){console.log(this.pushSubscription)}subscribePushNotification(){this.swPush.requestSubscription({serverPublicKey:this.VAPID_PUBLIC_KEY}).then(e=>{this.pushSubscription=e,this.isPermission=!0}).catch(console.log)}request(){}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.gz),t.Y36(S),t.Y36(C.N),t.Y36(p.Mk))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-register-code"]],decls:8,vars:8,consts:[["class","input-group mb-3",4,"ngIf"],["type","button","class","btn btn-primary",3,"disabled","click",4,"ngIf"],["type","button","class","btn btn-primary",3,"click",4,"ngIfDataInCookie","ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],[1,"input-group","mb-3"],["id","basic-addon1",1,"input-group-text"],["type","text","placeholder","Username","aria-label","Username","aria-describedby","basic-addon1",1,"form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary",3,"disabled","click"],["type","button",1,"btn","btn-primary",3,"click"],["role","alert",1,"alert","alert-success"]],template:function(e,i){1&e&&(t.YNc(0,x,4,1,"div",0),t.YNc(1,I,2,1,"button",1),t.YNc(2,A,2,0,"button",2),t.YNc(3,y,3,1,"div",3),t.YNc(4,R,3,1,"div",3),t.TgZ(5,"pre"),t._uU(6),t.ALo(7,"json"),t.qZA()),2&e&&(t.Q6J("ngIf",!i.dataInCookie),t.xp6(1),t.Q6J("ngIf",!i.dataInCookie),t.xp6(1),t.Q6J("ngIf",!i.isPermission),t.xp6(1),t.Q6J("ngIf",i.dataInCookie),t.xp6(1),t.Q6J("ngIf",i.isAlert),t.xp6(2),t.hij("    ",t.lcZ(7,6,i.pushSubscription),"\n"))},directives:[l.O5,d.Fj,d.JJ,d.On],pipes:[l.Ts],styles:[""]}),o})()}];let k=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[l.ez,h.Bz.forChild(P),d.u5,f.JF,p.Wr]]}),o})()}}]);